<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Meditaatio: 30 x 1 Min</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Asetukset fontille ja taustalle */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden; /* Estää vierityksen */
            color: #fff;
        }

        /* Kameranäkymän sijoittelu (AR-efekti) */
        #video-background {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%; 
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -2; /* Pidetään taustalla */
            object-fit: cover;
            filter: grayscale(80%) brightness(50%); /* Himmeä, rauhallinen AR-efekti */
        }
        
        /* Pääkontin erottelu taustasta */
        #app-container {
            z-index: 1;
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.4); /* Kevyt peitto kameralle */
        }

        /* Animaatio (Hengitysopas) */
        #breathing-circle {
            width: 150px;
            height: 150px;
            background-color: rgba(0, 255, 204, 0.5); /* Sini-vihreä */
            border-radius: 50%;
            transition: transform 6.5s ease-in-out; /* Tasainen siirtymä */
            opacity: 0;
        }

        /* Näkyvä luokka */
        .visible {
            opacity: 1 !important;
            transition: opacity 0.5s;
        }

    </style>
</head>
<body>

    <!-- 1. Kameranäkymä (Tausta/AR-Elementti) -->
    <video id="video-background" autoplay playsinline></video>

    <!-- 2. Pääsovelluskontti -->
    <div id="app-container">

        <!-- Yläosa: Otsikko ja tila -->
        <div class="w-full max-w-sm p-4 bg-gray-800 rounded-xl shadow-lg flex flex-col items-center">
            <h1 class="text-xl font-bold text-gray-100" id="script-title">1 Minuutin Meditaatio</h1>
            <p id="camera-status" class="text-sm mt-1 text-yellow-400">Kameraa ladataan...</p>
        </div>

        <!-- Keskiosa: Hengitysopas ja Teksti -->
        <div class="flex flex-col items-center justify-center flex-grow w-full">
            <!-- Hengitys-ympyrä (animaatio) -->
            <div id="breathing-circle" class="mb-8"></div>

            <!-- Dynaaminen ohjeteksti -->
            <div class="w-full max-w-lg p-6 bg-gray-700 rounded-xl shadow-2xl text-center">
                <p id="dynamic-text" class="text-lg font-semibold text-gray-100">
                    Paina 'Aloita' kuullaksesi opastuksen.
                </p>
            </div>
        </div>

        <!-- Alaosa: Painike -->
        <button id="start-button" class="w-full max-w-sm p-3 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-extrabold rounded-lg shadow-xl transition duration-150 transform active:scale-95">
            Aloita Satunnainen Meditaatio
        </button>

    </div>

    <script>
        // =========================================================================
        // === MEDITAATIOKÄSIKIRJOITUKSET (EDITOI NÄITÄ TEKSTEJÄ TÄSTÄ) ===
        // =========================================================================
        const scripts = [
            // Kesto: Noin 60 sekuntia
            { id: 1, title: "Hengityksen virta", text: "Aloita ottamalla muutama hidas, syvä hengitys. Anna vatsasi nousta ja laskea luonnollisesti. Tunnista ilman viileys sisäänhengityksellä ja lämpö uloshengityksellä. Pysähdy hetkeksi tähän tunteeseen. Anna itsellesi lupa olla läsnä tässä hetkessä. Olet turvassa. Hengitä sisään rauhaa, ulos huolia. Ota yksi syvä, viimeinen hengitys. Ja palaa tähän tilaan rauhassa.", duration: 60 },
            { id: 2, title: "Jalkojen ankkuri", text: "Tuo huomiosi jalkoihisi. Tunne, miten jalkapohjasi painavat maata vasten. Anna painovoiman vetää sinua alaspäin, maadoittaen sinut. Kuvittele, että jaloistasi kasvaa juuria syvälle maaperään. Ne pitävät sinut vakaana, olipa yläpuolellasi millainen myrsky tahansa. Ole yhteydessä maan tukeen. Jokaisella uloshengityksellä vapauta jännitys jaloista. Tunnista voima vakaudessasi. Kiitos itsellesi tästä hetkestä.", duration: 60 },
            { id: 3, title: "Käsien lämpö", text: "Aseta kätesi syliisi tai jaloillesi. Tunnustele kevyttä painetta kämmeniesi ja vartalosi välillä. Keskity käsien lämpötilaan. Onko se lämmin, viileä vai neutraali? Salli itsesi tuntea tämä tunne ilman tuomitsemista. Nämä kädet ovat tehneet työtä ja pitäneet huolta. Ojenna nyt itsellesi myötätuntoa tämän hiljaisen hetken kautta. Nämä ovat sinun kätesi. Kiitos itsellesi läsnäolosta.", duration: 60 },
            { id: 4, title: "Kehon kartta", text: "Aloita huomion tuominen päälaelta. Vie ajatuksesi hitaasti kasvojen lihaksiin – leuan rentous, otsan tasaisuus. Skannaa huomiollasi niska, hartiat ja selkä. Löydä alueet, joilla on jännitystä, ja hengitä suoraan niihin. Anna jännityksen liueta uloshengityksen mukana. Älä yritä korjata, vain tunnista ja salli. Koko kehosi on ankkurisi. Palaa hengitykseesi, kun olet valmis.", duration: 60 },
            { id: 5, title: "Äänten hyväksyntä", text: "Vie huomiosi ulkopuolisiin ääniin. Kuuntele niitä ilman nimeämistä tai tuomitsemista. Ne ovat vain ääniä, hetkellisiä värähtelyjä. Jos mieli alkaa tarttua ääniin, palaa lempeästi hengitykseesi. Sisään, ulos. Äänet tulevat ja menevät, aivan kuin ajatuksetkin. Sinun ei tarvitse reagoida niihin. Vain kuuntele ja ole. Voit olla rauhallinen riippumatta ympäröivästä maailmasta.", duration: 60 },
            { id: 6, title: "Istumisen tuki", text: "Tunne istuinluusi tuolia tai alustaa vasten. Tunnista selkärangan pituus ja hartioiden rentous. Tuki on tässä, juuri tässä alla. Sinun ei tarvitse pitää itseäsi pystyssä voimalla, vaan tukeutua alustaasi. Anna itsellesi lupa painua hieman raskaammaksi. Tämä fyysinen tuki on läsnä aina. Ole kiitollinen tästä hetken levosta.", duration: 60 },
            { id: 7, title: "Paineen havainnointi", text: "Keskity siihen, missä vaatteet koskettavat ihoasi. Tunne rintakehän paine, vyötärön tai hihansuiden kosketus. Tämä tunne tuo sinut tähän hetkeen. Nämä ovat pieniä muistutuksia siitä, että olet olemassa, juuri nyt. Sisään, ulos. Nämä pienet tuntemukset ankkuroivat sinut tähän paikkaan. Pysähdy tähän yksinkertaiseen läsnäoloon.", duration: 60 },
            { id: 8, title: "Rauhan tunne", text: "Hae sisäinen rauhan tunne. Jos et löydä sitä, etsi vain sen pieni kipinä, sen pieni mahdollisuus. Hengitä sisään tietoisuutta ja ulos kiirettä. Muista, että rauha ei ole poissa, se on vain peitetty huolilla. Anna sen pienen valon kasvaa. Tämä hetki on varattu sinulle. Ole lempeä itsellesi.", duration: 60 },
            { id: 9, title: "Myötätunto", text: "Tuota mieleesi henkilö, josta välität syvästi. Lähetä hänelle lämpimiä ajatuksia. Käännä nyt tämä sama lämpö itseesi. 'Olkoon minulla rauhaa. Olkoon minulla voimaa.' Ojenna itsellesi se ystävällisyys, jonka annat muille. Olet ansainnut tämän hetken huomion. Hengitä sisään myötätuntoa, ulos itse-epäilyä.", duration: 60 },
            { id: 10, title: "Tietoisuuden tila", text: "Anna ajatusten tulla ja mennä, kuin pilvet taivaalla. Älä tartu niihin, älä pakota niitä pois. Sinä et ole ajatuksesi, olet se, joka tarkkailee niitä. Palaa tähän tarkkailijan rooliin. Sisään, ulos. Tämä hetki on vapaa menneisyyden painosta ja tulevaisuuden odotuksista. Vain tämä hetki. Kiitos itsellesi läsnäolosta.", duration: 60 },
            { id: 11, title: "Olkapäiden vapautus", text: "Nosta olkapäät korviin uloshengityksellä ja pudota ne alas uloshengityksellä. Tunne, miten jännitys lähtee. Toista. Nosta, pidä, vapauta. Anna olkapäiden roikkua vapaana, kaukana korvista. Kanna vain se, mitä on välttämätöntä. Kaikki muu voi odottaa. Sisään, ulos. Vapaudu paineesta.", duration: 60 },
            { id: 12, title: "Pienet liikkeet", text: "Vie huomio sormenpäihisi. Liikuta niitä hyvin hitaasti, tunne liike ja kosketus. Pienetkin liikkeet ovat elämää. Hengitä syvään. Pienet liikkeet voivat tuoda suuren rauhan. Ole kiitollinen kyvystä tuntea ja liikkua. Kiitos itsellesi.", duration: 60 },
            { id: 13, title: "Valon visualisointi", text: "Kuvittele lämmin, rauhoittava valo, joka laskeutuu päälaellesi. Anna sen valon virrata alas kasvojesi yli, rentouttaen kaikki lihakset. Anna valon virrata niskaan, hartioihin, rintakehään ja vatsaan. Sisään, ulos. Jokaisella hengityksellä valo syvenee. Olet täynnä tätä valoa ja lämpöä. Tämä valo on sinun turvapaikkasi.", duration: 60 },
            { id: 14, title: "Kiitollisuuden hetki", text: "Mieti yhtä asiaa, josta voit olla kiitollinen juuri nyt, oli se kuinka pieni tahansa. Se voi olla kahvikuppi, lämmin peitto tai rauhallinen hetki. Tunnista se kiitollisuuden lämmin tunne rintakehässäsi. Hengitä sisään kiitollisuutta ja ulos valitusta. Ole kiitollinen tästä hetkestä.", duration: 60 },
            { id: 15, title: "Aamuankkuri", text: "Tämä hetki on päivän alku. Hengitä sisään selkeyttä ja ulos eilistä. Aseta itsellesi lempeä intentio tähän päivään: olla läsnä, olla ystävällinen. Sinulla on täysi valta siihen, miten aloitat päiväsi. Keskity tähän uuteen alkuun. Olet valmis. Kiitos itsellesi.", duration: 60 },
            { id: 16, title: "Iltarentoutus", text: "Anna päivän tapahtumien liueta. Hengitä sisään rauhaa ja ulos jännitystä. Keho tarvitsee lepoa, ja mieli tarvitsee hiljaisuutta. Salli itsesi vajota syvemmälle rentoutumiseen. Anna patjan tukea sinua. Olet tehnyt tarpeeksi. Lepää nyt.", duration: 60 },
            { id: 17, title: "Lapsen mieli", text: "Tuo mieleesi muisto hetkestä, jolloin olit täysin huolettomassa ja onnellisessa tilassa lapsena. Tunne se ilo kehossasi. Hengitä sisään tätä muistoa. Vaikka ajat ovat muuttuneet, se ilon kyky on sinussa edelleen. Ole läsnä tälle sisäiselle lapselle. Ole lempeä itsellesi.", duration: 60 },
            { id: 18, title: "Kyllä-sanan voima", text: "Hengitä sisään ja sano itsellesi 'Kyllä' tälle hetkelle, juuri sellaisena kuin se on. Ei tarvitse taistella. Vain hyväksyä. Uloshengityksellä sano 'Kyllä' itsesi hyväksynnälle. Tämä yksinkertainen myöntyminen tuo valtavan rauhan. Kyllä, minä olen tässä.", duration: 60 },
            { id: 19, title: "Nosteen tunne", text: "Tunne kevyt noste, aivan kuin sinua kannateltaisiin. Hengitä sisään ja tunne selkärangan pituus. Uloshengityksellä rentoudu, mutta pidä se kevyt noste. Ei tarvitse olla raskas. Ole kevyt ja vapaa. Sisään, ulos. Nauti tästä kannattelun tunteesta.", duration: 60 },
            { id: 20, title: "Vahvuuden tunnistaminen", text: "Mieti yhtä asiaa, jonka olet selvinnyt elämässäsi. Tunnista se sisäinen voima, joka auttoi sinua läpi. Tämä voima on aina mukanasi. Hengitä sisään tätä vahvuutta. Ulospäin, luota siihen. Sinä olet vahvempi kuin luuletkaan. Kiitä itseäsi sitkeydestä.", duration: 60 },
            { id: 21, title: "Sormenpäiden tunne", text: "Tuo huomio sormenpäihisi. Tunne niiden paino ja pieni pulssi. Nämä pienet tuntemukset ankkuroivat sinut tähän hetkeen. Hengitä sisään, ja tunne ne, ulos, ja rentouta ne. Tämä on todellisuus. Olet tässä. Kaikki muu on vain ajatusta.", duration: 60 },
            { id: 22, title: "Lihasten vapautus", text: "Keskity nyt niihin lihaksiin, jotka pitävät sinua istuessa ylhäällä: vatsalihakset, selkä. Rentouta ne kaikki hieman. Anna kehon löytää helpompi asento. Sinun ei tarvitse pitää itseäsi jännittyneenä. Vapauta keho. Vapauta mieli. Sisään, ulos.", duration: 60 },
            { id: 23, title: "Mielen jarrutus", text: "Jos mieli kiitää eteenpäin, sano hiljaa mielessäsi 'Pysähdy' ja palaa hengitykseen. Käsittele itseäsi kuin ystävää, joka on eksyksissä. Lempeästi ohjaa mieli takaisin tähän hetkeen. Sisään, ulos. Teet parhaasi. Ole kärsivällinen itsesi kanssa.", duration: 60 },
            { id: 24, title: "Vatsan rentous", text: "Tuo hengityksesi syvälle vatsaan. Tunnista, miten vatsa nousee kuin pallo sisäänhengityksellä ja laskee uloshengityksellä. Vatsa on usein jännityksen keskus. Rentouta se. Anna sen olla pehmeä. Hengitä syvään, anna mennä. Kiitos itsellesi.", duration: 60 },
            { id: 25, title: "Tyhjän tilan rauha", text: "Kun olet uloshengittänyt, tunnista pieni tauko ennen seuraavaa sisäänhengitystä. Se pieni tyhjä tila on täydellisen rauhan hetki. Pysähdy siihen tunteeseen. Sisään, ulos, ja tauko. Nauti tästä tyhjästä, rauhallisesta tilasta. Se on sinun. Olet läsnä.", duration: 60 },
            { id: 26, title: "Hymyileminen", text: "Nosta suunpieliäsi kevyesti. Pieni hymy kasvoillasi voi muuttaa koko kehosi kemian. Tämä ei ole pakotettu onnellisuus, vaan lempeä ele itsellesi. Hymyile sisään, ja hymyile ulos. Anna sen levitä silmiisi. Ole rauhassa.", duration: 60 },
            { id: 27, title: "Tämän hetken lahja", text: "Menneisyys on ohitse, tulevaisuus on tuntematon. Vain tämä sekunti on sinun. Hengitä sisään tätä hetkeä, sen ainutlaatuisuutta. Vapauta tarve olla jossain muualla. Olet juuri siinä, missä sinun täytyykin olla. Ole kiitollinen tästä lahjasta.", duration: 60 },
            { id: 28, title: "Lämmön tunnistus", text: "Tuo huomio kehosi sisäiseen lämpöön. Tunnista lämpö rintakehässä tai vatsassa. Hengitä sisään, ja tunne se lämpö. Ulos, ja jaa se. Tämä lämpö on elinvoimaa. Ole yhteydessä tähän sisäiseen energiaan. Sinä olet elossa.", duration: 60 },
            { id: 29, title: "Koko keho hengittää", text: "Kuvittele, että et hengitä vain keuhkoilla, vaan koko kehosi hengittää. Hengitä sisään jaloistasi, käsivarsistasi, päälaeltasi. Ulos koko kehostasi. Sisään, olet valo, ulos, olet rauha. Koko olemuksesi on ankkuri. Kiitos itsellesi.", duration: 60 },
            { id: 30, title: "Hiljainen lupaus", text: "Anna itsellesi hiljainen lupaus. Esimerkiksi: 'Olen ystävällinen itselleni tänään.' Hengitä sisään tätä lupausta, tunne se voima. Ulos, luota siihen. Sinulla on lupa pitää itsestäsi huolta. Sisään, ulos. Ota tämä voima mukaasi. Palaa tähän hetkeen.", duration: 60 }
        ];

        // =========================================================================
        // === SOVELLUSLOGIIKKA ===
        // =========================================================================
        const video = document.getElementById('video-background');
        const startButton = document.getElementById('start-button');
        const circle = document.getElementById('breathing-circle');
        const dynamicText = document.getElementById('dynamic-text');
        const cameraStatus = document.getElementById('camera-status');

        let isRunning = false;
        let scriptInterval;
        let scriptIndex = 0;

        // ----------------------------------------------------
        // KÄYNNISTÄ KAMERA (AR-TAUSTA)
        // ----------------------------------------------------
        const startCamera = () => {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }) // Käytetään takakameraa
                    .then(stream => {
                        video.srcObject = stream;
                        video.onloadedmetadata = () => {
                            video.play();
                            cameraStatus.textContent = "Kamera valmis";
                            cameraStatus.classList.remove('text-yellow-400');
                            cameraStatus.classList.add('text-green-400');
                        };
                    })
                    .catch(error => {
                        console.error("Kameran käynnistys epäonnistui:", error);
                        cameraStatus.textContent = "Kamera estetty tai ei saatavilla. (Käytössä vain musta tausta)";
                        cameraStatus.classList.remove('text-yellow-400');
                        cameraStatus.classList.add('text-red-400');
                        // Poista videotausta, jos kamera ei toimi
                        video.style.display = 'none';
                    });
            } else {
                cameraStatus.textContent = "Laitteesi ei tue kameraa.";
                cameraStatus.classList.remove('text-yellow-400');
                cameraStatus.classList.add('text-red-400');
                video.style.display = 'none';
            }
        };

        // ----------------------------------------------------
        // HENGITYSYMPYRÄN ANIMAATIO
        // ----------------------------------------------------
        const startBreathingAnimation = () => {
            circle.classList.add('visible');
            circle.style.animation = 'none';
            circle.offsetHeight; // Käsivoimainen uudelleenkäynnistys
            circle.style.animation = 'breathe 10s infinite ease-in-out';
        };

        const stopBreathingAnimation = () => {
            circle.style.animation = 'none';
            circle.classList.remove('visible');
        };

        // CSS-animaatio (luotu JS:llä, jotta se on yhdessä tiedostossa)
        const styleSheet = document.createElement('style');
        styleSheet.type = 'text/css';
        styleSheet.innerText = `
            @keyframes breathe {
                0% { transform: scale(1); opacity: 0.5; }
                40% { transform: scale(1.5); opacity: 0.8; } /* Sisäänhengitys (4s) */
                50% { transform: scale(1.5); opacity: 0.8; } /* Lyhyt tauko */
                100% { transform: scale(1); opacity: 0.5; } /* Uloshengitys (6s) */
            }
        `;
        document.head.appendChild(styleSheet);


        // ----------------------------------------------------
        // MEDITAATION KÄYNNISTYS
        // ----------------------------------------------------
        const startMeditation = () => {
            if (isRunning) return;

            isRunning = true;
            startButton.textContent = "Meditaatio käynnissä... (Paina lopettaaksesi)";
            startButton.classList.remove('bg-green-500');
            startButton.classList.add('bg-red-500');

            // 1. Valitse satunnainen käsikirjoitus
            const randomIndex = Math.floor(Math.random() * scripts.length);
            const script = scripts[randomIndex];
            document.getElementById('script-title').textContent = script.title;

            const words = script.text.split(' ');
            const totalWords = words.length;
            // 60 sekuntia / (sanoja/sekunti) * sanoja
            const totalDuration = 60 * 1000; 
            const intervalDuration = totalDuration / totalWords;

            // 2. Käynnistä animaatio
            startBreathingAnimation();

            // 3. Käynnistä lukijan/tekstin syöttö
            scriptIndex = 0;
            dynamicText.textContent = '';
            
            // **HUOM: TTS POIS KÄYTÖSTÄ HILJAISUUDEN VUOKSI:**
            // const synth = window.speechSynthesis;
            // const utterance = new SpeechSynthesisUtterance(script.text);
            // utterance.lang = 'fi-FI';
            // synth.speak(utterance);

            scriptInterval = setInterval(() => {
                if (scriptIndex < totalWords) {
                    // Lisää seuraava sana
                    dynamicText.textContent += words[scriptIndex] + ' ';
                    scriptIndex++;
                } else {
                    // Pysäytä meditaatio lopussa
                    clearInterval(scriptInterval);
                    stopMeditation();
                    dynamicText.textContent = "Meditaatio päättyi. Tunnista rauha itsessäsi.";
                }
            }, intervalDuration);

            // Aseta ajastin koko meditaation lopettamiseksi, jos jokin menee vikaan
            setTimeout(() => {
                if(isRunning) {
                     stopMeditation();
                     dynamicText.textContent = "Meditaatio päättyi. Tunnista rauha itsessäsi.";
                }
            }, totalDuration + 2000); // Kesto + 2 sekunnin varmuus
        };

        // ----------------------------------------------------
        // MEDITAATION LOPETUS
        // ----------------------------------------------------
        const stopMeditation = () => {
            if (!isRunning) return;

            isRunning = false;
            clearInterval(scriptInterval);
            stopBreathingAnimation();

            startButton.textContent = "Aloita Satunnainen Meditaatio";
            startButton.classList.remove('bg-red-500');
            startButton.classList.add('bg-green-500');
            document.getElementById('script-title').textContent = "1 Minuutin Meditaatio";
            // dynamicText.textContent = "Paina 'Aloita' kuullaksesi opastuksen."; // Jätetään viimeinen viesti näkyviin

            // HUOM: Jos TTS oli päällä, se olisi pysäytettävä tässä:
            // window.speechSynthesis.cancel();
        };

        // ----------------------------------------------------
        // KÄYNNISTYS
        // ----------------------------------------------------

        // Aseta kuuntelijat
        startButton.addEventListener('click', () => {
            if (isRunning) {
                stopMeditation();
            } else {
                startMeditation();
            }
        });

        // Käynnistä kamera heti sivun latauduttua
        window.onload = startCamera;
        
    </script>

</body>
</html>
